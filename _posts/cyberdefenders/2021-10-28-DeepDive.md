---
title: "DeepDive"
classes: wide
header:  
  teaser: /assets/images/CyberDefinders/DeepDive/1.gif
ribbon: SteelBlue
description: "DeepDive challenge From CyberDefinders, Solved By CTFCREATORS."
categories:
  - WalkThrough
  - CyberDefinders
  - Memory Forensics 
  - DFIR 
toc: true
---
# About Challenge.

Name  : DeepDive.

Scenario : You have given a memory image for a compromised machine. Analyze the image and figure out attack details.

Questions : 10 

File Name : banking-malware.vmem 

Tool : volatility

# Solve

In this writeup we are using volatility 2

## #1 What profile should you use for this memory sample?

To get the profile we just need to use imageinfo plugin 

```bash
vol.py -f banking-malware.vmem imageinfo
```
output 

```bash
INFO    : volatility.debug    : Determining profile based on KDBG search...
          Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_24000, Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_24000, Win7SP1x64_23418
                     AS Layer1 : WindowsAMD64PagedMemory (Kernel AS)
                     AS Layer2 : FileAddressSpace (/home/******************/cyberdefinder/DeepDive/banking-malware.vmem)
                      PAE type : No PAE
                           DTB : 0x187000L
                          KDBG : 0xf80002bef120L
          Number of Processors : 1
     Image Type (Service Pack) : 1
                KPCR for CPU 0 : 0xfffff80002bf1000L
             KUSER_SHARED_DATA : 0xfffff78000000000L
           Image date and time : 2021-02-09 00:51:25 UTC+0000
     Image local date and time : 2021-02-08 22:51:25 -0200
```

## #2 What is the KDBG virtual address of the memory sample?

you can find this Answer in same output for question #1.

## #3 There is a malicious process running, but it's hidden. What's its name?

once the process is hidden, we can't find it using the pslist plugin because the first step to hide a process is to unlink it from  ActiveProcessLink doubly linked list.

It's better to use psxview because it searches for any running process using 7 different ways, unlike the other plugins, which use only one way. 

```bash
vol.py -f banking-malware.vmem --profile Win7SP1x64_24000 psxview
```

output 

```bash
Offset(P)          Name                    PID pslist psscan thrdproc pspcid csrss session deskthrd ExitTime
------------------ -------------------- ------ ------ ------ -------- ------ ----- ------- -------- --------
0x000000007e651b00 services.exe            500 True   True   True     True   True  True    False    
0x000000007d9b4b00 svchost.exe            1772 True   True   True     True   True  True    True     
0x000000007d2e5060 VSSVC.exe              2104 True   True   True     True   True  True    True     
0x000000007da4bb00 lsm.exe                 516 True   True   True     True   True  True    False    
0x000000007d38cb00 vm3dservice.ex         2416 True   True   True     True   True  True    True     
0x000000007d97f940 svchost.exe             356 True   True   True     True   True  True    True     
0x000000007d827710 svchost.exe             636 True   True   True     True   True  True    True     
0x000000007fe47b00 CompatTelRunne          996 True   True   True     True   True  True    True     
0x000000007cf2fb00 WmiPrvSE.exe           3488 True   True   True     True   True  True    True     
0x000000007da0a060 winlogon.exe            480 True   True   True     True   True  True    True     
0x000000007d2735e0 dllhost.exe            2044 True   True   True     True   True  True    True     
0x000000007fcf0b00 sppsvc.exe             3016 True   True   True     True   True  True    True     
0x000000007d8ce920 WmiApSrv.exe           3692 True   True   True     True   True  True    True     
0x000000007d68c6b0 OfficeClickToR         1232 True   True   True     True   True  True    True     
0x000000007d353b00 dwm.exe                2236 True   True   True     True   True  True    True     
0x000000007e770060 SDXHelper.exe          2828 True   True   True     True   True  True    True     
0x000000007db38930 lsass.exe               508 True   True   True     True   True  True    False    
0x000000007d2f3580 dllhost.exe            3188 True   True   True     True   True  True    True     
0x000000007d5d7b00 WmiPrvSE.exe           1812 True   True   True     True   True  True    True     
0x000000007e682b00 taskhost.exe           2344 True   True   True     True   True  True    True     
0x000000007feb8b00 vmtoolsd.exe           1484 True   True   True     True   True  True    True     
0x000000007d24d2f0 SDXHelper.exe          3200 True   True   True     True   True  True    True     
0x000000007e5f45c0 svchost.exe             704 True   True   True     True   True  True    True     
0x000000007d6bab00 VGAuthService.         1432 True   True   True     True   True  True    True     
0x000000007d6dbb00 msdtc.exe              1968 True   True   True     True   True  True    True     
0x000000007ddcf060 svchost.exe             916 True   True   True     True   True  True    True     
0x000000007d336950 vds_ps.exe             2448 False  False  True     True   True  True    True     
0x000000007d2508c0 conhost.exe            3028 True   True   True     True   True  True    True     
0x000000007df7db00 SearchIndexer.         2616 True   True   True     True   True  True    True     
0x000000007d678060 wmpnetwk.exe            856 True   True   True     True   True  True    True     
0x000000007e8906d0 wininit.exe             412 True   True   True     True   True  True    True     
0x000000007d33eb00 taskhost.exe           2192 True   True   True     True   True  True    True     
0x000000007eae4060 CompatTelRunne         2984 True   True   True     True   True  True    True     
0x000000007e1bfb00 svchost.exe            3324 True   True   True     True   True  True    False    
0x000000007d69bb00 svchost.exe            1288 True   True   True     True   True  True    True     
0x000000007d902060 svchost.exe             868 True   True   True     True   True  True    True     
0x000000007d9ff610 svchost.exe            1132 True   True   True     True   True  True    True     
0x000000007d3fc3e0 vmtoolsd.exe           2424 True   True   True     True   True  True    True     
0x000000007d35db00 explorer.exe           2260 True   True   True     True   True  True    True     
0x000000007d203930 dllhost.exe            1832 True   True   True     True   True  True    True     
0x000000007d929370 audiodg.exe            1008 True   True   True     True   True  True    True     
0x000000007db26b00 svchost.exe            3084 True   True   True     True   True  True    True     
0x000000007e462b00 CompatTelRunne         2688 True   True   True     True   True  True    True     
0x000000007d3535a0 taskeng.exe            2244 True   True   True     True   True  True    True     
0x000000007d8a7b00 svchost.exe             756 True   True   True     True   True  True    True     
0x000000007d24da30 SDXHelper.exe          3196 True   True   True     True   True  True    True     
0x000000007d989b00 spoolsv.exe            1096 True   True   True     True   True  True    True     
0x000000007ddc4060 svchost.exe             960 True   True   True     True   True  True    True     
0x000000007fd4a6e0 ipconfig.exe           4008 True   True   False    True   False True    False    2021-02-09 00:51:25 UTC+0000
0x000000007dde39a0 csrss.exe               360 True   True   True     True   False True    True     
0x000000007fc46b00 cmd.exe                3732 True   True   False    True   False True    False    2021-02-09 00:51:25 UTC+0000
0x000000007ee7d6c0 smss.exe                272 True   True   True     True   False False   False    
0x000000007e9c6060 csrss.exe               424 True   True   True     True   False True    True     
0x000000007ffad860 System                    4 True   True   True     True   False False   False    
0x000000007fc52060 conhost.exe            3848 True   True   False    True   False True    False    2021-02-09 00:51:25 UTC+0000
```

The malware uses 2 methods to hide, first by unliking itself from the ActiveProcessLink list and changing the process object signature. 

## #4 What is the physical offset of the malicious process?

Psxview plugin shows the physical address for each process, so you can use question 3 output to answer this question.

## #5 What is the full path (including executable name) of the hidden executable?

You can answer this question in many ways, but the easiest one is to list all system files and gerp the malware name once we get its name from question 3.

```bash
vol.py -f banking-malware.vmem --profile Win7SP1x64_24000 filescan  | grep <hidden_process_name>
```

## #6 Which malware is this?

We are moving forward to fun.

Of course, you can use the cyberdefinders poster for this challenge to solve this question.
